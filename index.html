<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<title>#JoyZubeenDa : Remembering Zubeen Garg's Legacy</title>
<!-- Leaflet -->
<link href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" rel="stylesheet"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- Firebase (v8 compat as used in your original code) -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<!-- EmailJS -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js" type="text/javascript"></script>
<style>
:root{
  --accent:#0b74ff; --bg:#f6f7fb; --card:#ffffff; --text:#0b1726;
  --muted:#556; --glass:rgba(11,23,38,0.03); --card-shadow:0 6px 22px rgba(10,20,40,0.06);
  --max-width:1200px;
  --gold: #f9d342;
  --gallery-gap:18px;
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}
.dark{--bg:#0b1220;--card:#0f1724;--text:#e6eef8;--muted:#9aa9c3;--glass:rgba(255,255,255,0.03);--card-shadow:0 8px 30px rgba(0,0,0,0.6)}
.wrap{max-width:var(--max-width);margin:12px auto;padding:12px}
header{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap; background:linear-gradient(135deg,#071428 0%, #0b477a 60%); color:white; padding:18px;border-radius:12px}
.brand{display:flex;gap:12px;align-items:center}
.logo{width:64px;height:64px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#66a6ff);display:flex;align-items:center;justify-content:center;color:white;font-weight:800;font-size:20px;box-shadow:var(--card-shadow)}
.hero-text{max-width:720px}
h1{font-size:28px;margin:0;line-height:1.1}
.tagline{margin-top:6px;color:rgba(255,255,255,0.85);font-size:14px}
.controls{display:flex;gap:8px;align-items:center}
button{cursor:pointer;padding:8px 12px;border-radius:8px;border:0;font-size:14px}
.btn-primary{background:var(--accent);color:white;box-shadow:0 6px 20px rgba(11,116,255,0.12)}
.btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.12);color:inherit}
.grid{display:grid;grid-template-columns:2fr 1fr;gap:16px;margin-top:12px}@media (max-width:980px){.grid{grid-template-columns:1fr}}
.card{background:var(--card);border-radius:12px;padding:12px;box-shadow:var(--card-shadow)}
.section-title{font-size:16px;margin:0 0 8px 0}
.muted{color:var(--muted);font-size:13px}
.counter{font-size:34px;font-weight:700;margin-top:6px}
.virtual-candles{display:flex;flex-wrap:wrap;gap:6px;margin-top:12px}
.candle{width:14px;height:36px;border-radius:6px;background:linear-gradient(180deg,#ffdd88,#ffb347);position:relative;box-shadow:0 6px 12px rgba(255,120,20,0.12);transform-origin:center bottom}
.candle:after{content:'';position:absolute;left:50%;transform:translateX(-50%);top:-8px;width:6px;height:10px;border-radius:6px;background:#fff;filter:drop-shadow(0 6px 12px rgba(255,200,60,0.25))}
.candle.glow{box-shadow:0 10px 40px rgba(255,140,40,0.35), 0 0 28px rgba(255,160,30,0.18);transform:translateY(-3px)}
.candle .flame{position:absolute;left:50%;transform:translateX(-50%);top:-18px;width:10px;height:14px;border-radius:50% 50% 50% 50%/60% 60% 40% 40%;background: radial-gradient(circle at 30% 30%, #fff7b6 0 30%, #ffd24d 40%, #ff7a00 70%);opacity:0;pointer-events:none;filter:drop-shadow(0 6px 10px rgba(255,160,50,0.4))}
.candle.lit .flame{animation:flameFlicker 900ms infinite;opacity:1}
@keyframes flameFlicker{
  0%{transform:translateX(-50%) scale(0.9) translateY(-1px)}
  50%{transform:translateX(-50%) scale(1.05) translateY(-4px)}
  100%{transform:translateX(-50%) scale(0.95) translateY(-2px)}
}
.small{font-size:13px}
.row{display:flex;gap:8px;align-items:center}
input,select,textarea{width:100%;box-sizing:border-box;padding:10px;border-radius:8px;border:1px solid rgba(10,20,30,0.06);font-size:14px;background:white}
select:disabled{background:#eee;cursor:not-allowed}textarea{resize:vertical}
.footer{margin-top:12px;text-align:center;color:var(--muted)}
.footer-links{display:flex;gap:12px;justify-content:center;margin-top:6px}
.footer-links button{background:none;border:none;color:var(--accent);cursor:pointer;text-decoration:underline;padding:0}
.top-stats{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
.stat{background:rgba(0,0,0,0.03);padding:10px;border-radius:8px;text-align:center;min-width:120px}
.map-container{height:360px;border-radius:8px;overflow:hidden}
.pill{background:rgba(0,0,0,0.03);padding:6px 10px;border-radius:999px}
.hint{font-size:12px;color:var(--muted);margin-top:6px}
.memory-embed{margin-top:10px;max-width:100%;border-radius:8px}
.memory-embed iframe{width:100%;height:220px;border:0;border-radius:8px}
.memory-embed img{max-width:100%;height:auto;border-radius:8px}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.45);align-items:center;justify-content:center;padding:14px;z-index:9999}
.modal-card{width:100%;max-width:880px;background:var(--card);padding:16px;border-radius:12px;box-shadow:var(--card-shadow)}
.modal .row{flex-wrap:wrap}
.modal .close{background:none;border:0;font-size:18px;cursor:pointer}
.memory-item{padding:8px;border-bottom:1px solid var(--glass)}
.memory-rotator{height:220px;overflow:hidden;position:relative}
.memory-rotator .slide{position:absolute;left:0;right:0;top:0;bottom:0;opacity:0;transition:opacity .6s, transform .6s;transform:translateY(6px)}
.memory-rotator .slide.active{opacity:1;transform:translateY(0)}
/* make mode toggle compact on small screens */
@media (max-width:480px){
  header{padding:12px}
  .controls{order:2;margin-top:8px}
  .logo{width:56px;height:56px}
  h1{font-size:20px}
}

/* --- NEW: Gallery & Quotes (enhanced visuals) --- */
.top-visuals{width:100%;margin-top:14px;display:flex;flex-direction:column;gap:14px}
.gallery-section{background:linear-gradient(135deg,#ffffff99, #f3f6fb);border-radius:12px;padding:14px;display:grid;grid-template-columns:1fr 420px;gap:14px;align-items:start}
.gallery-left{padding:8px}
.gallery-right{padding:8px;border-radius:8px;background:linear-gradient(180deg,#fff,#f7fbff);box-shadow:var(--card-shadow);min-height:400px;display:flex;flex-direction:column;justify-content:space-between;align-items:center}
.gallery-title{font-size:18px;margin:0 0 6px 0}
.gallery-sub{font-size:13px;color:var(--muted)}
.gallery-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:var(--gallery-gap)}
.gallery-grid img{width:100%;height:160px;object-fit:cover;border-radius:12px;box-shadow:0 10px 30px rgba(3,10,25,0.05);transition:transform .35s cubic-bezier(.2,.9,.3,1), box-shadow .35s}
.gallery-grid img:hover{transform:translateY(-6px) scale(1.02);box-shadow:0 20px 44px rgba(3,10,25,0.12);cursor:pointer}
.view-all{margin-top:10px;display:inline-block;background:linear-gradient(90deg,var(--accent),#66a6ff);color:white;padding:8px 12px;border-radius:8px;text-decoration:none;box-shadow:0 10px 30px rgba(11,116,255,0.12)}
/* Lightbox (modal-like) */
.gallery-lightbox{display:none;position:fixed;inset:0;z-index:2000;background:linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.85));align-items:center;justify-content:center;padding:20px}
.gallery-lightbox.active{display:flex}
.gallery-lightbox img{max-width:94%;max-height:86vh;border-radius:10px;box-shadow:0 30px 80px rgba(0,0,0,0.6)}
.lb-close{position:absolute;top:22px;right:24px;background:rgba(255,255,255,0.06);border:0;color:white;padding:8px 12px;border-radius:8px;font-size:18px;cursor:pointer}

/* Quotes slider */
.quotes-section{border-radius:12px;padding:12px;background:linear-gradient(90deg,#0b1220,#0b2540);color:white;box-shadow:var(--card-shadow);display:flex;gap:12px;align-items:center}
.quotes-left{flex:1}
.quotes-right{width:280px;display:flex;flex-direction:column;gap:8px;align-items:center;justify-content:center}
.quotes-title{font-size:16px;margin:0;color:var(--gold);letter-spacing:0.6px}
.quote-slider{width:100%;height:100px;position:relative;overflow:hidden;display:flex;align-items:center}
.quote-item{position:absolute;left:0;right:0;opacity:0;padding:8px 14px;font-size:1.05rem;line-height:1.3;font-style:italic;transition:opacity .6s, transform .6s;transform:translateY(8px)}
.quote-item.active{opacity:1;transform:translateY(0)}
.quote-author{margin-top:10px;font-size:13px;color:#cbd5e1}

/* small screen adjustments */
@media (max-width:980px){
  .gallery-section{grid-template-columns:1fr; padding:12px}
  .gallery-right{order:2}
  .gallery-grid img{height:140px}
  .quotes-right{display:none}
  .quote-slider{height:auto}
}

/* --- Music section styles --- */
.music-section{display:flex;gap:12px;align-items:flex-start;margin-top:12px}
.music-embed{flex:1;border-radius:10px;overflow:hidden;background:linear-gradient(180deg,#fbfcff,#ffffff);box-shadow:var(--card-shadow);padding:8px}
.music-embed iframe{width:100%;height:170px;border:0;border-radius:8px}
@media (max-width:700px){.music-section{flex-direction:column}}
</style>
</head>
<body>
<div class="wrap" id="pageWrap">
<header>
<div class="brand">
<div class="logo">JZ</div>
<div class="hero-text">
<h1>Remembering Zubeen Garg</h1>
<div class="tagline">The Pride of Assam ‚Ä¢ 40+ Languages ‚Ä¢ 38,000+ Songs ‚Ä¢ Forever in Our Hearts</div>
</div>
</div>
<!-- Right side controls (keeps compact on mobile) -->
<div class="controls" id="headerControls">
<div class="pill small" id="modeLabel">Light Mode</div>
<button class="btn-ghost" id="modeToggle">Switch</button>
<button class="btn-primary" id="openCandleModal">Light Your Candle</button>
<button class="btn-primary" id="openMemoryForm">Share a Memory</button>
</div>
</header>
<!-- TOP VISUALS: Photo gallery + Famous Sayings slide (under the hero header) -->
<div class="top-visuals">
<!-- Gallery Section -->
<section aria-labelledby="galleryHeading" class="gallery-section card">
<div class="gallery-left">
<h3 class="gallery-title" id="galleryHeading">üì∏ Zubeen Garg ‚Äî Photo Gallery</h3>
<div class="gallery-grid" id="galleryGrid" style="margin-top:12px">
<!-- Images (public links) -->
<img alt="Zubeen Garg 1" src="https://anupupadhyaya.github.io/zubeen-tribute/images/zubeen1.jpeg"/>
<img alt="Zubeen Garg 2" src="https://anupupadhyaya.github.io/zubeen-tribute/images/zubeen2.jpeg"/>
<img alt="Zubeen Garg 3" src="https://anupupadhyaya.github.io/zubeen-tribute/images/zubeen3.jpeg"/>
<img alt="Zubeen Garg 4" src="https://anupupadhyaya.github.io/zubeen-tribute/images/zubeen4.jpeg"/>
</div>
</div>
<div class="gallery-right quotes-section">
<h4 class="quotes-title" id="iconicHeading" style="margin:0">üí¨ Iconic Lines by Zubeen Garg</h4>
<div aria-atomic="true" aria-live="polite" class="quote-slider" id="quoteSlider" style="margin-top:10px">
<div class="quote-item active">‚ÄúI have no caste, no religion. I don't believe in God. I am free. I am Kanchenjunga!‚Äù</div>
<div class="quote-item">‚ÄúAssam is Famous for Tea, Rhino, and Zubeen.‚Äù</div>
<div class="quote-item">‚ÄúI live like a King, and a King should not leave his kingdom.‚Äù</div>
</div>

<!-- Music section placed directly below iconic lines, fills the extra space -->
<div class="music-section" style="width:100%; margin-top:12px">
<!-- YouTube embed: autoplay muted (some browsers may block autoplay; muted ensures it can autoplay) -->
<div aria-hidden="false" aria-label="YouTube player" class="music-embed">
<!-- Video ID used here is an example; change the ID to the video you want. It is concrete and not a placeholder. -->
<iframe allow="autoplay; encrypted-media" loading="lazy" src="https://www.youtube.com/embed/videoseries?list=PL3cTse0YhM79CcS9HP_BpzPkuJe94EYV7" title="Zubeen Garg - Iconic Song"></iframe>

</div>
<!-- Spotify embed -->
<div aria-hidden="false" aria-label="Spotify player" class="music-embed">
<!-- This points to a Spotify embed URL. Replace if you want a different playlist. -->
<iframe allow="encrypted-media" loading="lazy" src="https://open.spotify.com/embed/artist/3mpgtUc7wYBNjr04gEiQ4u?utm_source=generator" title="Zubeen Garg Playlist"></iframe>

</div>
</div>
</div>
</section>
<!-- Lightbox container (hidden, toggled by JS) -->
<div aria-hidden="true" class="gallery-lightbox" id="galleryLightbox" role="dialog">
<button class="lb-close" id="lbCloseBtn">√ó</button>
<img alt="Enlarged Zubeen image" id="lbImage" src=""/>
</div>
</div>
<!-- Original site content (candle card, memory wall, map, stats, forms etc.) -->
<div class="grid" style="margin-top:16px">
<main>
<!-- Candle card -->
<section class="card" id="candleCard">
<div style="display:flex;justify-content:space-between;align-items:center">
<div>
<div class="section-title">üïØÔ∏è Light a Virtual Candle</div>
<div class="muted">Join fans across the world to honor Zubeen Garg's legacy.</div>
</div>
<div style="text-align:right">
<div class="muted">Total Candles Lit</div>
<div class="counter" id="candleCount">0</div>
</div>
</div>
<div class="row" style="margin-top:12px">
<button class="btn-primary" id="openCandleModal2">Light Your Candle</button>
<div class="hint" style="margin-left:8px"></div>
</div>
<div aria-hidden="true" class="virtual-candles" id="candleArea" style="min-height:60px"></div>
<div style="margin-top:14px;display:flex;gap:12px;align-items:center;flex-wrap:wrap;">
<div style="max-width:320px;"><canvas id="candleChart" style="height:180px"></canvas></div>
<div style="flex:1; min-width:240px;">
<div class="top-stats">
<div class="stat"><small>Top State</small><strong id="topState">‚Äî</strong></div>
<div class="stat"><small>Top District (Assam)</small><strong id="topDistrict">‚Äî</strong></div>
<div class="stat"><small>Top Country</small><strong id="topCountry">‚Äî</strong></div>
</div>
</div>
</div>
</section>
<!-- Memory wall -->
<section class="card" id="memoryCard" style="margin-top:14px">
<div style="display:flex;justify-content:space-between;align-items:center">
<div>
<div class="section-title">üñºÔ∏è Global Memory Wall</div>
<div class="muted"><span id="memoryCount">0</span> memories shared</div>
</div>
<div><button class="btn-primary" id="openMemoryForm2">Share a Memory</button></div>
</div>
<div style="margin-top:12px">
<div class="memory-rotator" id="memoryWall">
<!-- slides populated by JS -->
</div>
</div>
</section>
<section class="card" style="margin-top:16px">
<div class="section-title">üìú Timeline &amp; Beliefs</div>
<div style="display:flex;gap:12px;align-items:flex-start">
<div style="flex:1">
<p><strong>1972</strong> : Born. Early musical interest.</p>
<p><strong>2000s</strong> : Became a multi-lingual recording artist, singing in 40+ languages.</p>
<p><strong>2010s</strong> : Social activism &amp; animal rights. Championed cultural pride.</p>
<p><strong>Legacy</strong> : A powerful voice across India &amp; abroad; celebrated by fans worldwide.</p>
</div>
<div style="width:240px">
<div class="card small"><div class="small muted">Notable</div><div style="margin-top:6px"><strong>40+</strong> languages</div><div><strong>38,000+</strong> songs</div></div>
</div>
</div>
</section>
</main>
<aside>
<div class="card map-card">
<div class="section-title">üåç Global Legacy Map</div>
<div class="muted">Pins from memories &amp; candles. Countries represented: <strong id="countryCount">0</strong></div>
<div class="map-container" id="map"></div>
</div>
<div class="card" style="margin-top:12px">
<div class="section-title">Live Stats</div>
<div class="stat" style="text-align:left; min-width: 0;"><small>Total Candles</small><strong id="statCandles">0</strong></div>
<div style="height:10px"></div>
<div class="stat" style="text-align:left; min-width: 0;"><small>Total Memories</small><strong id="statMemories">0</strong></div>
</div>
<div class="card" style="margin-top:12px">
<div class="section-title">Top Regions</div>
<div class="muted">Top 5 states (candles)</div><ol id="topStatesList"></ol>
<div class="muted">Top Assam districts</div><ol id="topDistrictsList"></ol>
</div>
<div class="card" style="margin-top:12px">
<div class="section-title">üí° Suggestions</div>
<form id="suggestionForm">
<textarea name="suggestion" placeholder="Have a suggestion to improve this site?" required="" rows="4"></textarea>
<button class="btn-primary" style="width:100%; margin-top:8px;" type="submit">Send Suggestion</button>
<div class="hint" id="suggestionMsg">Your feedback is appreciated!</div>
</form>
</div>
</aside>
</div>
<div class="footer">
    Built with ‚ù§Ô∏è for Zubeen-Da. This is a non-commercial, shared tribute.
    <div class="footer-links"><button id="openContactModalBtn">Contact Me</button></div>
</div>
</div>
<!-- Candle Modal -->
<div aria-hidden="true" class="modal" id="candleModal">
<div aria-labelledby="candleTitle" aria-modal="true" class="modal-card" role="dialog">
<div style="display:flex;justify-content:space-between;align-items:center">
<h3 id="candleTitle" style="margin:0">Light a Candle</h3>
<button class="close" id="candleCloseBtn">√ó</button>
</div>
<div class="muted">Choose your location and light a virtual candle. You can light only once per browser session.</div>
<div style="margin-top:12px">
<label class="small">Name (optional)</label><input id="candleName" placeholder="Your name (or leave blank)"/>
</div>
<div class="row" style="margin-top:8px">
<div style="flex:1">
<label class="small">Country</label>
<select id="candleCountry"></select>
</div>
<div style="flex:1">
<label class="small">State (India only)</label>
<select id="candleState"></select>
</div>
</div>
<div style="margin-top:8px">
<label class="small">District (Assam only)</label>
<select id="candleDistrict"></select>
</div>
<div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end">
<button class="btn-ghost" id="candleCancel" type="button">Cancel</button>
<button class="btn-primary" id="candleSubmit">Light Candle</button>
</div>
<div class="muted" id="candleMsg" style="margin-top:8px"></div>
</div>
</div>
<!-- Memory Modal -->
<div aria-hidden="true" class="modal" id="memoryModal">
<div aria-labelledby="memoryTitle" aria-modal="true" class="modal-card" role="dialog">
<div style="display:flex;justify-content:space-between;align-items:center">
<h3 id="memoryTitle" style="margin:0">Share a Memory</h3>
<button class="close" id="memoryCloseBtn">√ó</button>
</div>
<div class="muted">Your submission will be stored for review and will only appear on the Memory Wall after approval.</div>
<form id="memoryForm" style="margin-top:12px;display:grid;gap:8px">
<div style="display:flex;gap:8px"><input name="name" placeholder="Your name (or anonymous)"/><input name="email" placeholder="Email (optional, not displayed)"/></div>
<div style="display:flex;gap:8px"><input name="city" placeholder="City / Town"/><input name="institute" placeholder="Institute / Profession"/></div>
<div style="display:flex;gap:8px"><select id="memCountry" name="country"></select><select id="memState" name="state"></select></div>
<div><textarea name="text" placeholder="Write your memory here. You can also paste a YouTube or image URL." rows="4"></textarea></div>
<div style="display:flex;gap:8px;justify-content:flex-end">
<button class="btn-ghost" id="memoryCancelBtn" type="button">Cancel</button>
<button class="btn-primary" type="submit">Submit Memory</button>
</div>
<div class="muted" id="memoryMsg"></div>
</form>
</div>
</div>
<!-- Contact Modal -->
<div aria-hidden="true" class="modal" id="contactModal">
<div aria-labelledby="contactTitle" aria-modal="true" class="modal-card" role="dialog">
<div style="display:flex;justify-content:space-between;align-items:center">
<h3 id="contactTitle" style="margin:0">Contact Me</h3>
<button class="close" id="contactCloseBtn">√ó</button>
</div>
<form id="contactForm" style="margin-top:12px;display:grid;gap:8px">
<input name="contact_name" placeholder="Your Name" required=""/>
<input name="contact_email" placeholder="Your Email" required="" type="email"/>
<input name="contact_mobile" placeholder="Your Mobile Number (Optional)"/>
<textarea name="contact_message" placeholder="Your Message" required="" rows="4"></textarea>
<div style="display:flex;gap:8px;justify-content:flex-end">
<button class="btn-ghost" id="contactCancel" type="button">Cancel</button>
<button class="btn-primary" type="submit">Send Message</button>
</div>
<div class="hint" id="contactMsg" style="text-align: right;"></div>
</form>
</div>
</div>
<script>
// =================================================================================
// COMPLETE SCRIPT (Firebase Firestore + EmailJS + Map + Chart + UI + Gallery + Quotes + Music embed + moderation)
// =================================================================================

// ---------- 1. FIREBASE CONFIG ----------
const firebaseConfig = {
  apiKey: "AIzaSyAMu6Tddmn8ha4U-c1GnfKH3SGEdOOxNAU",
  authDomain: "zubeen-da-tribute.firebaseapp.com",
  projectId: "zubeen-da-tribute",
  storageBucket: "zubeen-da-tribute.firebasestorage.app",
  messagingSenderId: "1042239604011",
  appId: "1:1042239604011:web:dc5a21816c38d67ce3b16e",
  measurementId: "G-WTGYWBD88D"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ---------- 2. EMAILJS CONFIG ----------
const EMAILJS_PUBLIC_KEY = "_0aDRZ63IQ2E-2Dzk";
const EMAILJS_SERVICE_ID = "service_qkbh7r8";
const EMAILJS_TEMPLATE_CONTACT = "template_6q94z4d";
const EMAILJS_TEMPLATE_SUGGESTION = "template_21pqjmq";
emailjs.init(EMAILJS_PUBLIC_KEY);

// ---------- 3. GLOBALS & DATA LISTS ----------
let ALL_CANDLES = [];
let ALL_MEMORIES = []; // only approved ones will be fetched for display
const COUNTRIES = ["India","United States","United Kingdom","Canada","Australia","Bangladesh","Nepal","Bhutan","United Arab Emirates","Singapore","Malaysia","Germany","France","Others"];
const INDIA_STATES = ["Andaman and Nicobar Islands", "Andhra Pradesh", "Arunachal Pradesh", "Assam", "Bihar", "Chandigarh", "Chhattisgarh", "Dadra and Nagar Haveli and Daman & Diu", "Delhi", "Goa", "Gujarat", "Haryana", "Himachal Pradesh", "Jammu & Kashmir", "Jharkhand", "Karnataka", "Kerala", "Ladakh", "Lakshadweep", "Madhya Pradesh", "Maharashtra", "Manipur", "Meghalaya", "Mizoram", "Nagaland", "Odisha", "Puducherry", "Punjab", "Rajasthan", "Sikkim", "Tamil Nadu", "Telangana", "Tripura", "Uttar Pradesh", "Uttarakhand", "West Bengal"];
const ASSAM_DISTRICTS = ["Bajali", "Baksa", "Barpeta", "Bongaigaon", "Cachar", "Charaideo", "Chirang", "Darrang", "Dhemaji", "Dhubri", "Dibrugarh", "Dima Hasao", "Goalpara", "Golaghat", "Hailakandi", "Jorhat", "Kamrup", "Kamrup Metropolitan", "Karbi Anglong", "Karimganj", "Kokrajhar", "Lakhimpur", "Majuli", "Morigaon", "Nagaon", "Nalbari", "Sivasagar", "Sonitpur", "South Salmara-Mankachar", "Tinsukia", "Udalguri", "West Karbi Anglong"];
const COUNTRY_COORDS = {
  "India": [20.5937, 78.9629],
  "United States": [38.9637, -95.7129],
  "United Kingdom": [55.3781, -3.4360],
  "Canada": [56.1304, -106.3468],
  "Australia": [-25.2744, 133.7751],
  "Bangladesh": [23.6850, 90.3563],
  "Nepal": [28.3949, 84.1240],
  "Bhutan": [27.5142, 90.4336],
  "United Arab Emirates": [23.4241, 53.8478],
  "Singapore": [1.3521, 103.8198],
  "Malaysia": [4.2105, 101.9758],
  "Germany": [51.1657, 10.4515],
  "France": [46.6031, 1.8883],
  "Others": [20,20]
};
const STATE_COORDS = {
  "Andaman and Nicobar Islands": [11.7401, 92.6586],
  "Andhra Pradesh": [15.9129, 79.7400],
  "Arunachal Pradesh": [28.2180, 94.7278],
  "Assam": [26.2006, 92.9376],
  "Bihar": [25.0961, 85.3131],
  "Chandigarh": [30.7333, 76.7794],
  "Chhattisgarh": [21.2787, 81.8661],
  "Dadra and Nagar Haveli and Daman & Diu": [20.1809, 73.0169],
  "Delhi": [28.7041, 77.1025],
  "Goa": [15.2993, 74.1240],
  "Gujarat": [22.2587, 71.1924],
  "Haryana": [29.0588, 76.0856],
  "Himachal Pradesh": [31.1048, 77.1734],
  "Jammu & Kashmir": [33.7782, 76.5762],
  "Jharkhand": [23.6102, 85.2799],
  "Karnataka": [15.3173, 75.7139],
  "Kerala": [10.8505, 76.2711],
  "Ladakh": [34.1526, 77.5771],
  "Lakshadweep": [10.5667, 72.6417],
  "Madhya Pradesh": [22.9734, 78.6569],
  "Maharashtra": [19.7515, 75.7139],
  "Manipur": [24.6637, 93.9063],
  "Meghalaya": [25.4670, 91.3662],
  "Mizoram": [23.1645, 92.9376],
  "Nagaland": [26.1584, 94.5624],
  "Odisha": [20.9517, 85.0985],
  "Puducherry": [11.9416, 79.8083],
  "Punjab": [31.1471, 75.3412],
  "Rajasthan": [27.0238, 74.2179],
  "Sikkim": [27.5330, 88.5122],
  "Tamil Nadu": [11.1271, 78.6569],
  "Telangana": [18.1124, 79.0193],
  "Tripura": [23.9408, 91.9882],
  "Uttar Pradesh": [26.8467, 80.9462],
  "Uttarakhand": [30.0668, 79.0193],
  "West Bengal": [22.9868, 87.8550]
};
const DISTRICT_COORDS = {
  "Bajali": [26.4913, 91.1734],
  "Baksa": [26.7610, 91.3507],
  "Barpeta": [26.3273, 91.0083],
  "Bongaigaon": [26.4716, 90.5601],
  "Cachar": [24.8333, 92.8000],
  "Charaideo": [27.0984, 95.1438],
  "Chirang": [26.6500, 90.6500],
  "Darrang": [26.4673, 92.1643],
  "Dhemaji": [27.4833, 94.5833],
  "Dhubri": [26.0271, 89.9740],
  "Dibrugarh": [27.4728, 94.9113],
  "Dima Hasao": [25.3857, 92.9118],
  "Goalpara": [26.17, 90.62],
  "Golaghat": [26.5167, 93.9667],
  "Hailakandi": [24.6833, 92.5667],
  "Jorhat": [26.7500, 94.2167],
  "Kamrup": [26.1667, 91.7500],
  "Kamrup Metropolitan": [26.1445, 91.7362],
  "Karbi Anglong": [26.1685, 93.5878],
  "Karimganj": [24.8667, 92.3500],
  "Kokrajhar": [26.4000, 90.2667],
  "Lakhimpur": [27.2333, 94.1167],
  "Majuli": [27.0160, 94.2160],
  "Morigaon": [26.2500, 92.3333],
  "Nagaon": [26.3500, 92.6833],
  "Nalbari": [26.4500, 91.4333],
  "Sivasagar": [27.0000, 94.6333],
  "Sonitpur": [26.6347, 92.7923],
  "South Salmara-Mankachar": [25.8078, 89.9011],
  "Tinsukia": [27.4914, 95.3619],
  "Udalguri": [26.7667, 92.1000],
  "West Karbi Anglong": [25.8617, 92.8364]
};

// ---------- 4. MAP ----------
const map = L.map('map', { attributionControl:false }).setView([26.2006, 92.9376], 5);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:18}).addTo(map);
let markersLayer = L.layerGroup().addTo(map);

// ---------- 5. CHART ----------
const candleCtx = document.getElementById('candleChart').getContext('2d');
let candleChart = new Chart(candleCtx, {
  type:'bar',
  data: { labels:[], datasets:[{label:'Candles',data:[], backgroundColor:['#f59e0b','#60a5fa','#93c5fd','#34d399','#a3a3a3']}] },
  options:{responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}}, indexAxis: 'y'}
});

// ---------- 6. UTILITIES ----------
function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
function truncate(s,l){ return s.length>l? s.slice(0,l)+'...': s; }
function renderMedia(text){
  const urlRegex = /(https?:\/\/[^\s]+)/g;
  return (text||'').replace(urlRegex, url => {
    if (/\.(jpg|jpeg|png|gif)$/i.test(url)) return `<div class="memory-embed"><img src="${escapeHtml(url)}" loading="lazy"></div>`;
    const yMatch = url.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/);
    if (yMatch) return `<div class="memory-embed"><iframe src="https://www.youtube.com/embed/${yMatch[1]}" frameborder="0" allowfullscreen></iframe></div>`;
    return `<a href="${escapeHtml(url)}" target="_blank">${escapeHtml(url)}</a>`;
  });
}
function getCoords(entry){
  if (entry.district && DISTRICT_COORDS[entry.district]) return DISTRICT_COORDS[entry.district];
  if (entry.state && STATE_COORDS[entry.state]) return STATE_COORDS[entry.state];
  if (entry.country && COUNTRY_COORDS[entry.country]) return COUNTRY_COORDS[entry.country];
  return null;
}
function createCandleElement(lit=false){
  const d = document.createElement('div');
  d.className = 'candle' + (lit ? ' lit glow' : '');
  const flame = document.createElement('div'); flame.className = 'flame';
  d.appendChild(flame);
  return d;
}

// ---------- 7. POPULATE DROPDOWNS ----------
function populateDropdowns(){
  const candleCountry = document.getElementById('candleCountry');
  const candleState = document.getElementById('candleState');
  const candleDistrict = document.getElementById('candleDistrict');
  const memCountry = document.getElementById('memCountry');
  const memState = document.getElementById('memState');

  ['candleCountry','memCountry'].forEach(id=>{
    const sel = document.getElementById(id); sel.innerHTML='';
    COUNTRIES.forEach(c => { const o = document.createElement('option'); o.value=c; o.textContent=c; sel.appendChild(o); });
  });

  [candleState, memState].forEach(select=>{
    select.innerHTML='';
    const d = document.createElement('option'); d.value=''; d.textContent='Select state'; select.appendChild(d);
    INDIA_STATES.forEach(s=>{ const o=document.createElement('option'); o.value=s; o.textContent=s; select.appendChild(o); });
  });

  candleDistrict.innerHTML=''; const d0=document.createElement('option'); d0.value=''; d0.textContent='Select district'; candleDistrict.appendChild(d0);
  ASSAM_DISTRICTS.forEach(dist => { const o=document.createElement('option'); o.value=dist; o.textContent=dist; candleDistrict.appendChild(o); });

  document.getElementById('candleCountry').addEventListener('change', ()=>{
    const isIndia = document.getElementById('candleCountry').value === 'India';
    document.getElementById('candleState').disabled = !isIndia;
    document.getElementById('candleDistrict').disabled = !isIndia;
    document.getElementById('candleDistrict').style.display = isIndia ? 'block' : 'none';
    if(!isIndia){ document.getElementById('candleState').value=''; document.getElementById('candleDistrict').value=''; }
  });
  document.getElementById('candleState').addEventListener('change', ()=>{
    document.getElementById('candleDistrict').style.display = (document.getElementById('candleState').value === 'Assam') ? 'block' : 'none';
    if (document.getElementById('candleState').value !== 'Assam') document.getElementById('candleDistrict').value='';
  });
  document.getElementById('memCountry').addEventListener('change', ()=>{
    const isIndia = document.getElementById('memCountry').value === 'India';
    document.getElementById('memState').disabled = !isIndia;
    if(!isIndia) document.getElementById('memState').value='';
  });
}
populateDropdowns();

// ---------- 8. RENDERING & MAP PINS ----------
function renderMapPins(){
  markersLayer.clearLayers();
  const addMarker = (coords, popupText, options={})=>{
    const marker = options.isCandle ? L.circleMarker(coords, {radius:6, color:'#ffb347', fillOpacity:0.9, weight:1}) : L.marker(coords);
    marker.bindPopup(popupText);
    markersLayer.addLayer(marker);
  };

  ALL_MEMORIES.forEach(m => {
    const coords = getCoords(m);
    if(coords){
      const locationInfo = [m.city, m.institute].filter(Boolean).join(' ‚Ä¢ ');
      const popupHTML = `<strong>${escapeHtml(m.name||'Anonymous')}</strong><div class="small">${escapeHtml(locationInfo)}</div><div style="margin-top:6px">${escapeHtml(truncate(m.text||'',200))}</div>`;
      addMarker(coords, popupHTML, {isCandle:false});
    }
  });

  ALL_CANDLES.forEach(c => {
    const coords = getCoords(c);
    if(coords){
      const locationInfo = [c.district, c.state, c.country].filter(Boolean).join(', ');
      const popupHTML = `<strong>Candle by ${escapeHtml(c.name||'Anonymous')}</strong><div class="small">From: ${escapeHtml(locationInfo)}</div>`;
      addMarker(coords, popupHTML, {isCandle:true});
    }
  });
}

function renderStatsAndCharts(){
  const getTopN = (counts,n=5) => Object.entries(counts).sort((a,b)=>b[1]-a[1]).slice(0,n);
  const countryC = ALL_CANDLES.reduce((a,c)=>{a[c.country]=(a[c.country]||0)+1;return a;},{});
  const stateC = ALL_CANDLES.reduce((a,c)=>{ if(c.state) a[c.state]=(a[c.state]||0)+1; return a; },{});
  const districtC = ALL_CANDLES.reduce((a,c)=>{ if(c.district) a[c.district]=(a[c.district]||0)+1; return a; },{});
  const topCountries = getTopN(countryC);
  candleChart.data.labels = topCountries.map(c=>c[0]);
  candleChart.data.datasets[0].data = topCountries.map(c=>c[1]);
  candleChart.update();

  const topStateEl = document.getElementById('topState');
  const ts1 = getTopN(stateC,1)[0]; topStateEl.textContent = ts1 ? `${ts1[0]} (${ts1[1]})` : '‚Äî';
  const td1 = getTopN(districtC,1)[0]; document.getElementById('topDistrict').textContent = td1 ? `${td1[0]} (${td1[1]})` : '‚Äî';
  const tc1 = getTopN(countryC,1)[0]; document.getElementById('topCountry').textContent = tc1 ? `${tc1[0]} (${tc1[1]})` : '‚Äî';

  document.getElementById('topStatesList').innerHTML = getTopN(stateC).length ? getTopN(stateC).map(s=>`<li>${escapeHtml(s[0])} ‚Äî ${s[1]}</li>`).join('') : '<li class="muted">No data</li>';
  document.getElementById('topDistrictsList').innerHTML = getTopN(districtC).length ? getTopN(districtC).map(s=>`<li>${escapeHtml(s[0])} ‚Äî ${s[1]}</li>`).join('') : '<li class="muted">No data</li>';

  // Country count
  document.getElementById('countryCount').textContent = new Set(ALL_MEMORIES.map(m=>m.country).concat(ALL_CANDLES.map(c=>c.country)).filter(Boolean)).size;
}

function renderAll(){
  // counts
  document.getElementById('candleCount').textContent = ALL_CANDLES.length.toLocaleString();
  document.getElementById('statCandles').textContent = ALL_CANDLES.length.toLocaleString();
  document.getElementById('memoryCount').textContent = ALL_MEMORIES.length.toLocaleString();
  document.getElementById('statMemories').textContent = ALL_MEMORIES.length.toLocaleString();

  // candle area
  const candleArea = document.getElementById('candleArea');
  candleArea.innerHTML = '';
  // show up to 100 candle visuals
  for(let i=0;i<Math.min(ALL_CANDLES.length,100);i++){
    const c = createCandleElement(true);
    candleArea.appendChild(c);
  }

  // memory wall rotation will be handled separately
  populateMemoryRotator();

  renderMapPins();
  renderStatsAndCharts();
}

// ---------- 9. FIRESTORE LISTENERS ----------
// Candles (all)
db.collection("candles").orderBy("ts","desc").onSnapshot(snapshot => {
  ALL_CANDLES = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
  renderAll();
});

// Memories: IMPORTANT ‚Äî only approved:true are fetched for public display
// Admins can set approved:true in Firebase Console to publish a memory.
db.collection("memories").where("approved","==",true).orderBy("ts","desc").onSnapshot(snapshot => {
  ALL_MEMORIES = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
  renderAll();
});

// ---------- 10. FORM SUBMISSIONS ----------

// Candle submit
document.getElementById('candleSubmit').onclick = async () => {
  const candleMsg = document.getElementById('candleMsg');
  if (localStorage.getItem('JOY_CANDLE_LIT')) {
    candleMsg.textContent = 'Thank you : You have already lit a candle, Cheers!.';
    return;
  }
  const btn = document.getElementById('candleSubmit');
  btn.disabled = true; candleMsg.textContent = 'Processing...';

  const entry = {
    name: (document.getElementById('candleName').value || 'Anonymous').trim(),
    country: document.getElementById('candleCountry').value || 'India',
    state: document.getElementById('candleState').value || '',
    district: document.getElementById('candleDistrict').value || '',
    ts: new Date()
  };

  try {
    await db.collection("candles").add(entry);
    localStorage.setItem('JOY_CANDLE_LIT', 'true');

    // Add a quick candle animation in the UI
    const area = document.getElementById('candleArea');
    const newC = createCandleElement(true);
    newC.classList.add('lit');
    area.insertBefore(newC, area.firstChild);

    document.getElementById('candleModal').style.display = 'none';
    document.getElementById('candleMsg').textContent = 'Thank you : candle lit!';
  } catch(err){
    console.error('Error adding candle:', err);
    candleMsg.textContent = 'An error occurred. Please try again.';
  } finally {
    btn.disabled = false;
  }
};

// Memory submit -> sets approved:false by default (moderation)
document.getElementById('memoryForm').addEventListener('submit', async (ev) => {
  ev.preventDefault();
  const memoryMsg = document.getElementById('memoryMsg');
  const fd = new FormData(ev.target);
  if (!fd.get('text') || !fd.get('text').trim()) {
    memoryMsg.textContent = 'Please write a memory.';
    return;
  }
  const submitBtn = ev.target.querySelector('button[type="submit"]');
  submitBtn.disabled = true; memoryMsg.textContent = 'Submitting...';

  const obj = {
    name: fd.get('name') || 'Anonymous',
    city: fd.get('city') || '',
    institute: fd.get('institute') || '',
    country: fd.get('country') || 'India',
    state: fd.get('state') || '',
    text: fd.get('text'),
    ts: new Date(),
    approved: false  // <-- moderation flag: defaults to false
  };

  try {
    await db.collection("memories").add(obj);
    memoryMsg.textContent = 'Memory submitted for review. Thank you!';
    ev.target.reset();
    // keep modal open briefly to show message, then close
    setTimeout(()=>{ document.getElementById('memoryModal').style.display = 'none'; }, 900);
  } catch(err){
    console.error('Error adding memory:', err);
    memoryMsg.textContent = 'An error occurred. Please try again.';
  } finally {
    submitBtn.disabled = false;
  }
});

// Suggestion submit (EmailJS)
document.getElementById('suggestionForm').addEventListener('submit', function(e){
  e.preventDefault();
  const submitBtn = e.target.querySelector('button[type="submit"]');
  const msgDiv = document.getElementById('suggestionMsg');
  submitBtn.disabled = true; msgDiv.textContent = 'Sending...';

  emailjs.sendForm(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_SUGGESTION, this)
    .then(()=>{ msgDiv.textContent = 'Suggestion sent. Thank you!'; e.target.reset(); }, (error)=>{ msgDiv.textContent='Failed to send. Please try again.'; console.error('EMAILJS FAILED', error); })
    .finally(()=> submitBtn.disabled = false);
});

// Contact form (EmailJS)
document.getElementById('contactForm').addEventListener('submit', function(e){
  e.preventDefault();
  const submitBtn = e.target.querySelector('button[type="submit"]');
  const msgDiv = document.getElementById('contactMsg');
  submitBtn.disabled = true; msgDiv.textContent = 'Sending...';

  emailjs.sendForm(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_CONTACT, this)
    .then(()=> {
      msgDiv.textContent = 'Message sent successfully!';
      setTimeout(()=>{ document.getElementById('contactModal').style.display = 'none'; e.target.reset(); msgDiv.textContent=''; }, 1200);
    }, (error) => {
      msgDiv.textContent = 'Failed to send. Please try again.';
      console.error('EMAILJS FAILED...', error);
    })
    .finally(()=> submitBtn.disabled = false);
});

// ---------- 11. MODAL UI + toggles ----------

// Helper functions
function openModal(id){
  document.getElementById(id).style.display = 'flex';
  document.getElementById(id).setAttribute('aria-hidden','false');
}
function closeModal(id){
  document.getElementById(id).style.display = 'none';
  document.getElementById(id).setAttribute('aria-hidden','true');
}

// Wire modal open/close buttons (all)
document.getElementById('openCandleModal').onclick = ()=> openModal('candleModal');
document.getElementById('openCandleModal2').onclick = ()=> openModal('candleModal');
document.getElementById('candleCancel').onclick = ()=> closeModal('candleModal');
document.getElementById('candleCloseBtn').onclick = ()=> closeModal('candleModal');

document.getElementById('openMemoryForm').onclick = ()=> { document.getElementById('memoryForm').reset(); document.getElementById('memCountry').value='India'; document.getElementById('memState').disabled=false; openModal('memoryModal'); };
document.getElementById('openMemoryForm2').onclick = ()=> { document.getElementById('memoryForm').reset(); document.getElementById('memCountry').value='India'; document.getElementById('memState').disabled=false; openModal('memoryModal'); };
document.getElementById('memoryCancelBtn').onclick = ()=> closeModal('memoryModal');
document.getElementById('memoryCloseBtn').onclick = ()=> closeModal('memoryModal');

document.getElementById('openContactModalBtn').onclick = ()=> openModal('contactModal');
document.getElementById('contactCancel').onclick = ()=> closeModal('contactModal');
document.getElementById('contactCloseBtn').onclick = ()=> closeModal('contactModal');

// Close on background click for all modals
document.querySelectorAll('.modal').forEach(m=>{
  m.addEventListener('click', (e)=>{
    if(e.target === m) closeModal(m.id);
  });
});
// Close on Escape
window.addEventListener('keydown', (e) => { if(e.key === 'Escape'){ document.querySelectorAll('.modal').forEach(m=> closeModal(m.id)); } });

// ---------- 12. MODE (dark/light) ----------
const modeToggle = document.getElementById('modeToggle');
const modeLabel = document.getElementById('modeLabel');
function setMode(d){
  document.documentElement.classList.toggle('dark', d);
  document.body.classList.toggle('dark', d);
  modeLabel.textContent = d ? 'Dark Mode' : 'Light Mode';
  localStorage.setItem('JZ_MODE_DARK', d ? '1' : '0');
}
modeToggle.onclick = ()=> setMode(!document.documentElement.classList.contains('dark'));
setMode(localStorage.getItem('JZ_MODE_DARK') === '1' || (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches));

// ---------- 13. MEMORY WALL ROTATOR (auto-play up to 10 most recent) ----------
let rotatorTimer = null;
let rotatorIndex = 0;
function populateMemoryRotator(){
  const wall = document.getElementById('memoryWall');
  wall.innerHTML = '';
  if(!ALL_MEMORIES.length){
    wall.innerHTML = '<div class="muted" style="padding:12px;">No memories yet.</div>';
    return;
  }
  // take up to 10 most recent
  const slides = ALL_MEMORIES.slice(0,10).map(m => {
    const slide = document.createElement('div'); slide.className='slide';
    // renderMedia already returns safe html for images/iframes/links; but escape other text
    const mediaHtml = renderMedia(m.text || '');
    const info = `<div class="memory-item"><strong>${escapeHtml(m.name||'Anonymous')}</strong> <span class="muted">‚Ä¢ ${escapeHtml([m.city,m.institute].filter(Boolean).join(' ‚Ä¢ '))}</span><div style="margin-top:6px;white-space:pre-wrap;word-break:break-word;">${mediaHtml}</div></div>`;
    slide.innerHTML = info;
    return slide;
  });
  slides.forEach((s,i)=>{ s.style.zIndex = slides.length - i; wall.appendChild(s); });
  // activate first
  rotatorIndex = 0;
  slides.forEach(s => s.classList.remove('active'));
  if(slides[0]) slides[0].classList.add('active');

  // clear previous timer
  if(rotatorTimer) { clearInterval(rotatorTimer); rotatorTimer = null; }

  // auto-rotate every 5s
  rotatorTimer = setInterval(()=>{
    const next = (rotatorIndex + 1) % slides.length;
    slides[rotatorIndex].classList.remove('active');
    slides[next].classList.add('active');
    rotatorIndex = next;
  }, 5000);

  // pause on hover
  wall.addEventListener('mouseenter', ()=> { if(rotatorTimer) clearInterval(rotatorTimer); });
  wall.addEventListener('mouseleave', ()=> {
    if(rotatorTimer) clearInterval(rotatorTimer);
    rotatorTimer = setInterval(()=>{
      const next = (rotatorIndex + 1) % slides.length;
      slides[rotatorIndex].classList.remove('active');
      slides[next].classList.add('active');
      rotatorIndex = next;
    }, 5000);
  }, { once: false });
}

// ---------- 14. INITIAL RENDER ----------
function init(){
  renderAll();
  console.log('Joy Zubeen tribute site initialized.');
}
init();

// ---------- 15. GALLERY LIGHTBOX FUNCTIONALITY ----------
const galleryGrid = document.getElementById('galleryGrid');
const lb = document.getElementById('galleryLightbox');
const lbImg = document.getElementById('lbImage');
const lbClose = document.getElementById('lbCloseBtn');

galleryGrid.querySelectorAll('img').forEach(img=>{
  img.addEventListener('click', (e)=>{
    const full = img.getAttribute('data-full') || img.src;
    lbImg.src = full;
    lb.classList.add('active');
    lb.setAttribute('aria-hidden','false');
    document.body.style.overflow = 'hidden';
  });
});
lbClose.addEventListener('click', closeLightbox);
lb.addEventListener('click', (e)=>{ if(e.target === lb) closeLightbox(); });
function closeLightbox(){
  lb.classList.remove('active');
  lb.setAttribute('aria-hidden','true');
  lbImg.src = '';
  document.body.style.overflow = '';
}

// ---------- 16. QUOTES SLIDER ----------
const quoteItems = document.querySelectorAll('.quote-item');
let currentQuote = 0;
let quoteTimer = setInterval(nextQuote, 4500);
function nextQuote(){
  if(!quoteItems.length) return;
  quoteItems[currentQuote].classList.remove('active');
  currentQuote = (currentQuote + 1) % quoteItems.length;
  quoteItems[currentQuote].classList.add('active');
}
// pause on hover
const quoteSliderEl = document.getElementById('quoteSlider');
quoteSliderEl.addEventListener('mouseenter', ()=> { clearInterval(quoteTimer); });
quoteSliderEl.addEventListener('mouseleave', ()=> { clearInterval(quoteTimer); quoteTimer = setInterval(nextQuote,4500); });

// ---------- 17. Safety: handle missing image/iframe URLs gracefully (already done in renderMedia) ----------
</script>
</body>
</html>
